#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#pragma warning(disable:4996)
#include <stdint.h>
#include <stddef.h>
#include <time.h>
#include <unistd.h>

void manageAccount();

typedef struct {

  char accountnumber[10];

  void(*print)(void*);

} Account;

typedef struct {

  char accountnumber[128];

} serverAccount;

void sendToServer(Account* account, serverAccount* serverside) {

  free(account);

  serverside = malloc(256);

  printf("주 ~F~L ~R %p", manageAccount); 

  scanf("%128s", serverside->accountnumber);

  printf(" ~X리 ~P~\ ~D ~L ~J~T ~K ~]~L과 ~Y ~J ~K~H ~K . : "); 

  account->print(account);

}

void captchaFinalStage() {

        int* captcha6;
	scanf("%d", captcha6);
        if(*captcha6 == -1284512){
                char* captcha7;
			scanf("%s", captcha7);
                if(strncmp((char*)"AF9381ty9hf9A*H6",(const char*)captcha7, 16) == 0){
                        int* captcha8 ;
						scanf("%d", captcha8);
                        if(*captcha8 == -952){
                                int one, two, three;
                                //printf("\t\t\t\t\tFINAL!!!\n");
                                scanf("%d %d %d", &one, &two, &three);
                               // one = 2;
                                //two = 3;
                                //three = 4;
                                int* hashTable = (int*)malloc(sizeof(int)*((int)one + 20));
                                int *lightHash = (int*)(two + 24);
                                int *heavyHash = (int*)(three + 28);
                                for (int i = 0; i < *lightHash; i++) {
                                        hashTable[i] = i;
                                        printf("%d ", hashTable[i]);
                                        if (i % 10 == 9)
                                        printf("\n");
                                }

                                free(hashTable);

                                for (int i = 0; i < *heavyHash; i++) {
                                        printf("%d ", hashTable[i]);
                                        if (i % 10 == 9)
                                                printf("\n");
                                }
                        }
                }
        }
}
void captchaFifthStage() {
  //int *account = (int*)(Data + 16);
  //printf("\t\tarr3 : %d\n", *account);
  int* captcha ;
  //printf(" ~K ~]~L 보 ~] ~J~T ~H ~^~P를 ~^~E | ~U 주 ~D ~Z~T : 5");
  scanf("%d", captcha);
  if (*captcha==912627) {
        //printf("\ncaptcha : %d\n", *captcha);
        int* captcha5;
	  scanf("%d", captcha5);
        if(*captcha5 == -9247){
                captchaFinalStage();
        }
  }
}
void captchaFourthStage() {
  //int *account = (int*)(Data + 16);
  //printf("\t\tarr3 : %d\n", *account);
  int* captcha;
  //printf(" ~K ~]~L 보 ~] ~J~T ~H ~^~P를 ~^~E | ~U 주 ~D ~Z~T : 5");
  scanf("%d", captcha);
  if (*captcha==555) {
        //printf("\ncaptcha : %d\n", *captcha);
        int* captcha4 ;
	  scanf("%d", captcha4);
        if(*captcha4 == -3295613){
                captchaFifthStage();
        }
  }
}
void captchaThirdStage() {
  //int *menu = (int*)(Data + 12);
  //printf("\t\tarr2 : %d\n", *menu);
  int* captcha;
  //printf(" ~K ~]~L 보 ~] ~J~T ~H ~^~P를 ~^~E | ~U 주 ~D ~Z~T : 1234");
  scanf("%d", captcha);
  if (*captcha ==1234) {
        int* captcha3;
	  scanf("%d", captcha3);
        if(*captcha3 == -239852){
                captchaFourthStage();
        }
  }
}
void captchaSecondStage() {
  //int *account = (int*)(Data + 16);
  //printf("\t\tarr3 : %d\n", *account);
  int* captcha;
  printf(" ~K ~]~L 보 ~] ~J~T ~H ~^~P를 ~^~E | ~U 주 ~D ~Z~T : 5");
  scanf("%d", captcha);
  if (*captcha==10) {
        int* captcha2;
	  scanf("%d", captcha2);
        if(*captcha2 == 192746){

        //printf("\ncaptcha : %d\n", *captcha);
                captchaThirdStage();
        }
  }
}
void captchaFirstStage() {
  //int *menu = (int*)(Data + 12);
  //printf("\t\tarr2 : %d\n", *menu);
  int* captcha ;
  printf(" ~K ~]~L 보 ~] ~J~T ~H ~^~P를 ~^~E | ~U 주 ~D ~Z~T : 1234");
  scanf("%d", captcha);
  if (*captcha ==10) {
        int* captcha1;
	  	scanf("%d", captcha1);
        if(*captcha1 == 28365){
                captchaSecondStage();
        }
  }
}
void printAccount(Account* account) {

  printf("%s\n", account->accountnumber);

}

void manageAccount(void) {// | ~] ~@리- ~@리 ~^~P ~Z ~U ~H~X

  FILE* fd = fopen("/root/week9/useafter/fuzz1/userInfo.txt", "r");

  //printf("This is Shell\n");

  char* pstr;

  char strTemp[33];

  while (!feof(fd)) {

     pstr = fgets(strTemp, sizeof(strTemp) + 1, fd);

     //printf("%s",strTemp);

     char* a = strtok(strTemp, " ");

     char* b = strtok(NULL, " ");

     char* c = strtok(NULL, " ");

     char* d = strtok(NULL, " ");

     //printf("%s %s %s %s ",a, b, c, d);

     printf("%s", b);

  }

}

typedef enum { false, true } bool;

bool login(char* input_id, char* input_pw, char* compare_id, char* compare_pw, FILE* fd) {

  char* pstr;

  char strTemp[33];

  while (!feof(fd)) {

     pstr = fgets(strTemp, sizeof(strTemp) + 1, fd);

     compare_id = strtok(strTemp, " ");

     compare_pw = strtok(NULL, " ");

     if (!strncmp(input_id, compare_id,8)) {

        if (!strncmp(input_pw, compare_pw,8)) {

           return true;

        }

        else {

           return false;

        }

     }

     else

     {

        return false;

     }

  }

  return false;

}

bool compare(char* input_account, char* compare_account, char* compare_accountpw, FILE* fd) {

        //if(strlen(input_account) <= 8)

        //      return false;

        //printf("\ninput acc : %.8s", input_account);

  char* pstr;

  char strTemp[33];

  rewind(fd);

        compare_account="21249115";

        //printf("com acc : %s\ninput acc : %s\n",compare_account, input_account);

  while (!feof(fd)) {

     pstr = fgets(strTemp, sizeof(strTemp) + 1, fd);

     //compare_account = strtok(strTemp, " ");

     //compare_account = strtok(NULL, " ");

        //compare_account = strtok(NULL, " ");

        //printf("com : %s\ninput : %.8s\n",compare_account,input_account);

     //strcpy(compare_account, strtok(NULL, " "));

     if (strncmp(input_account, compare_account, 8) == 0) {

        //strcpy(compare_accountpw, strtok(NULL, " "));

        return true;

     }

  }

  return false;

}

void send(char* input_id, char* input_pw, char* compare_id, char* compare_pw, char* input_account, char* compare_account,

                                                char* input_accountpw, char* compare_accountpw, FILE* fd)

{

     printf(" ~U~D ~] ~T~T를 ~^~E | ~U 주 ~D ~Z~T. \n ID : ");

     scanf("%s", input_id);

     printf(" ~D ~@ ~H ~X 를 ~^~E | ~U 주 ~D ~Z~T.\n PW : ");

     scanf("%s", input_pw);

 

        //input_id = (char*)Data;

        //input_pw = (char*)(Data+8);

 

 

     if (login(input_id, input_pw, compare_id, compare_pw, fd)) {

        printf(" ~^~E ~H ~U~X ~K ~D ~L를 ~^~E | ~U 주 ~D ~Z~T.");

        scanf("%s", input_account);

        //input_account = (char*)(Data+16);

        //input_account="21249115";

        if (compare(input_account, compare_account, compare_accountpw, fd)) {

        //      printf("\n ~U ~X \n");

           Account* account;

           serverAccount* serverside = NULL;

           account = malloc(256);

           //strcpy(account->accountnumber, compare_account);

           printf(" ~^~E | ~U~X ~K|  ~D ~L ~J~T ~K ~]~L과 ~Y ~J ~K~H ~K . : ");

           account->print = (void*)printAccount;

           account->print(account);

 

           sendToServer(account, serverside);

        }

     }

}

void delAccount()
{
     /////////////////////////////////printf(" ~D | ~U ~B | ~\를 ~[~P ~U~X ~K~\면 [delete!] ~] |  ~^~E | ~U 주 ~D ~Z~T : ");
     //char* command = malloc(8);
     //scanf("%s", command);
     //if (command[0] == 'd'&&command[1] == 'e'&&command[2] == 'l'&&command[3] == 'e' &&command[4] == 't'&& command[5] == 'e'&&command[6] == '!') {
        //int* pw = (int*)(command + 8);
        //printf("\tarr1 : %d\n", *arr1);
        int* captcha;
        ///////////////////////////////////////printf("\n ~K ~]~L 보 ~] ~J~T ~H ~^~P를 ~^~E | ~U 주 ~D ~Z~T : 999");
        scanf("%d", captcha);
        if (*captcha == 999) {
                //printf("captcha : %d\n", (int*)captcha);
           captchaFirstStage();
        }
     //}
}

int main(){


FILE* fd = fopen("/root/week9/useafter/fuzz1/userInfo.txt", "r");

  if (fd == NULL){
        return -1;
  }
  char* input_id;
  char* input_pw;
  char* compare_id;
  char* compare_pw;
  char* input_account;
  char* compare_accountpw;
  char* compare_account;
  char* input_accountpw;
  //printf(" ~Y~X ~X~A ~U ~K~H ~K ! ~[~P ~U~X ~K~\ ~J~T 거 ~^~X를 ~D| ~C~] ~U~X ~D ~Z~T. 1: ~F ~H ~U~X기 2: ~D | ~U ~B | ~\");
    int dealnum;
   scanf("%d", &dealnum);
        //dealnum = 1;
  if (dealnum == 1) {
        send(input_id, input_pw, compare_id, compare_pw, input_account, compare_account, input_accountpw, compare_accountpw, fd);
  }
  else if (dealnum == 2) {
     delAccount();
  }
else {
     printf(" ~^~X못 ~^~E | ~^~E ~K~H ~K . ");
     return 0;
  }
  system("pause");
}